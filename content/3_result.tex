\chapter{Conclusions after the development}

\section{Accomplishments}

Over the period of the it project, participation in a number of areas of development were performed:

\begin{itemize}
	\item Improving Code quality for example refactoring.
	\item Documentation.
	\item Writing unit tests and integration tests.
	\item Bug fixes.
	\item Implementation of features.
\end{itemize}

It was possible to get the code quality to a point where no warnings or complication errors occurred.
The all pull requests described in the section \ref{accomplishment_code_quality} contributed to this success.

Contribution in regard of documentation was another portion of development, listed in \ref{accomblishment_docs}.
This not involved the markdown files at the project root and the comments within the source code but also the part of the ion manual.
This will hopefully server future contributors well.

Ion Shell as any other software contains bugs of course. Some the bugs could be fixed via code contribution on my side, listed in \ref{accomplishment_bug_fixes}.
A few features were also achieved, listed in \ref{accomplishment_features}.

The integration tests of Ion Shell were analyzed and comprehended. On one hand this knowledge could be leveraged to create effective tests
which verify the correct behaviour of the implemented features and bug fixes.
On the other hand this understanding lead to a section about how to write the integration tests in Ion Shell \cite{pr_docs_how_to_integration_test}.

\section{Status of Ion Shell}

\subsection{Capabilities of Ion Shell}

Ion Shell is not only capable of running on redox os but also quit well on a Linux distribution.
This fact became more than clear by the my conducted development of Ion Shell on a Linux distribution.

The scripting API of Ion Shell allows for writing more correct automation compared to shells like bash shell.
Structural typing and various higher level language features like expansion \ref{ion_shell_lang_expansion} methods \ref{ion_shell_lang_methods} and control flow \ref{ion_shell_lang_control_flow}.

\subsection{Problems with Ion Shell}\label{label:problems_ion_shell}

However Ion Shell has unfortunately several troublesome areas
which hinders development and wider adoption among users.
This section points out those aspects of Ion Shell which should be improved on.

\newcommand{\itemIonShellRegularContributor}{Ion Shell has no regular contributors}
\newcommand{\itemIonShellCI}{
	Ion Shell has not mainted dependencies
}
\newcommand{\itemIonShellDistribution}{
	Ion Shell has no distribution for end user on Linux
}
\newcommand{\itemIonShellDependencies}{Ion Shell CI is not functioning correctly}

\begin{itemize}
	\item \itemIonShellRegularContributor
	\item \itemIonShellDependencies
	\item \itemIonShellDistribution
	\item \itemIonShellCI
\end{itemize}

\subsection{\itemIonShellRegularContributor}

The repository of Ion Shell does not indicate an active development community
from the beginning of the it project up to the moment of writing.
Before my first contribution
the last commit of someone else than the BDFL of Redox Os, Jeremy Soller,
was on Nov 27, 2022.
Up to the moment of writing most commits were done by me.
An exceptions was an occasional pull request \cite{pr_ion_shell_global_alias}.
Throughout the it-project there was only one person, BDFL of Redox Os, who reviewed and accepted pull requests.
A prolonged lack of regular contributors could lead to a complete halt in the development of Ion Shell.

\subsection{\itemIonShellDependencies}

A number of dependencies used by Ion Shell are not maintained anymore ... If newly needed features or bugs arise from those libraries, then someone has to do it on their own.
This puts more complexity on the new potential contributors as they might have to learn and adjust separate code bases.

\subsection{\itemIonShellDistribution}

Ion Shell can be still considered an alpha program.
During the development phase of it project I discovered pretty fast new bugs and needed features.
With a larger user space these issues could be detected early.
More users could provide more feedback to the program and even attract potential contributor.
Additional contributors is what this project really needs the most.
Ion Shell can be complied and run on Linux.
However it lacks official distribution channels for linux end user .
A user indenting to use this shell, has to install the rust tool chain before and then compile the program.
More Linux use rend users could be reached the program would be released on distribution channels like dnf, apt etc .. .

\subsection{\itemIonShellCI}\label{section:ci_ion_shell}

Not all jobs of the Ion Shell CI' do still not complete successfully.
This is problematic. While local compilation and manually
run test suit can provide detection of problems, it not enforced.
Every pull requests therefore require also inspection of the compilation
and a working test suit for the code reviewer.
This could be automated with a proper CI.
Beside causing more work for the reviewer, it also can hinder
the confidence of new contributors not knowing that CI can run successfully right now.
I tried communicating this problem via following issues \cite{issue_ci_linux_stable_fail}.
In addition I talked to the community
about this on the matrix server on several occasions \cite{matrix_channel}.

\section{What is left to do in Ion Shell}

This section describes which goals for the it project could not be archived.
The description also contains the reasons why a goal could be accomplished.

\begin{itemize}
	\item Incorporate the source location, (file name, line number, column number) into the error message.
	\item Implement wild card expansion for various schemes like disk ..
	\item Make the CI work on all jobs possible.
\end{itemize}

The following bullet points were non-goals during the it-project. Nonetheless they were identified as worthwhile endeavours.

\begin{itemize}
	\item Provide various deploy set ups to publish Ion Shell on various package managers like apt, dnf, ..
	\item Port Ion Shell to windows.
\end{itemize}

\subsection{Enriching error messages}

One area of contribution was focused on enriching error message in Ion Shell.
Error messages in Ion Shell already provide specific information about what problem occured.
However the details within certain error messages had some potential for improvement.
The following merged pull requests of mine were focused on that areas:

\begin{itemize}
	\item Out of bounds errors show the invalid index and the length of an array \cite{pr_error_message_shows_invalid_range}.
	\item Errors because of the reference of an undeclared variable now show the name of the undeclared one \cite{pr_better_not_found_variable_show}.
\end{itemize}

Another aspect of missing information for error messages was the source location where an error was encountered.
The source location is the respective line and column number.
The source location in an error message as a feature were noted down in an still opened issue \cite{issue_enrich_error_message_information} .
It was my indentation to add the source location to a raised error message.
In the end of the it project I was not able to do so though.
The parser of ion shell does not keep track of line and columns numbers for statements.
Because of this, one can not simply incorporate the source location into the error messages.

A workaround was attempted via counting at least the line numbers per executed statement.
There is a for loop, see code snippet \ref{code:execution_for_code_snippet} as a simplfied and modified version,
which terminates, parses and executes statements one by one in Ion Shell.
In the modified version there two additional statements.
The first addition the declaration of the line numbers to count per statement at line \ref{code:execute_loop_line_init}.
The second addition the increment of the line numbers  per statement at line \ref{code:execute_loop_line_increment}.
Those modifications ought to keep track of the line number of the current statement.

\clearpage

\rustCode{execution_loop}{code:execution_for_code_snippet}{file_ref_execute_loop}{For loop which terminates,parses and interprets statements}

That attempt however did not work for all scenarios.
In cases of calling a function the line numbers were not correct however.
This oddity comes from the fact that statements within a function are executed in a batch.
Let us consider the following ion script snippet \ref{code:function_batch_error_location}.
If an error occurs at line \ref{code:ion_undefined_variable},
then the line number is wrongly \ref{code:ion_print_call}
with the workaround because counted line number refers to the function call.

\clearpage

\localIonCode{function_batch_error_location}{code:function_batch_error_location}{Example with undefined variable error}

In addition the execution of string and array methods do not propagate their error up to the execution loop \ref{code:execution_for_code_snippet}
like the rest of the code base.
If an error is caused, a message is directly printed to the console,
between line \ref{code:ion_status_print_err_1} and \ref{code:ion_status_print_err_2} within \ref{code:ion_file_status}.
This not consistent and should be refactored so that the error is propagated
to the previously mentioned execution loop \ref{code:execution_for_code_snippet}.

\rustCode{status_struct}{code:ion_file_status}{ion_file_status}{How builtin method print raised errors directly to the consoel}


In my view the best solution is to rewrite the tokenisation and parsing.
This rewrite should make token/language items linked to their respective column and line number.
That refactor however requires coordination with the repository owners and significant amount of work
which exceeds the available time I could afford to spend for the it project.

\subsection{Wild card expansion of schemes resources}

Since Ion Shell is meant to be used as the default shell within Redox os,
the correct handling of paths to resources of schemes is a vital part.
Schemes in redox Os facilitate inter process communication on redox Os.
A scheme signifies a certain type of a resource.
The following snippet shows an example of reference to a resource within the file scheme.
\begin{verbatim}
 file:/home/some_user/some data
\end{verbatim}
The name of the scheme comes before ":" character.
The part behind that character resembles a reference to a resource, a file or directory with the name "some data".

Ion shell as program running in Redox Os, has the kernel handle the resolution of resources of certain scheme.
However the kernel itself does not have the concept of wild cards within a reference of scheme.
According the conses among the Redox Os developer community here Ion Shell is meant to jump in and handle the resolution of wildcards.
This opinion came up through a discussion on the matrix server, \cite{matrix_channel}.
The following example is expected to be resolved to all paths under the folder "/home/some\_user".
\begin{verbatim}
 file:/home/some_user/*
\end{verbatim}

While developing on Ion Shell I could implement a workaround for the wild card expansion of the file scheme
via the pull request \cite{pr_file_scheme} .
This pull requests relates to the issue \cite{issue_file_scheme}.
Expansion for other schemes like "disk" are still missing.
This missing feature is documented by following issue \cite{issue_disk_scheme}.
Over time it became clear that the wild card expansion for schemes should be implemented in separate rust crate, within the Redox Os community.
Creating a separate library is outside the scope of this it project though.

\subsection{Make all jobs work on the CI}

As described in one of the improvable development aspects of Ion Shell, \ref{label:problems_ion_shell}, the CI of Ion Shell should
work properly. The job 'linux:stable' still fails. Mending this job of the CI probably requires contribution
on redoxer repository \cite{link_repos_redoxer} and an update of  the docker image on docker hub \cite{docker_hub_redoxer}.

\subsection{Make Ion Shell available as binary on different Linux distribution}

At the moment of writing this report,
the only way to use Ion Shell as an end user is to compile the program with the rust compiler.
The problem caused by that are described in \ref{section:ci_ion_shell}.

\subsection{Porting to windows}

According to a page of Ion manual a port to windows is desired \cite{ion_manual_instroduction}.
This port could indeed increase the number of users since windows
as an OS has a large user base in the desktop realm.

\subsection{Migration from Makefiles/Bash to cargo-xtask automation}

While cargo for Rust simplifies compiling and running of rust programs,
task like running the test suit or building the ion manual are however project specific.
Specific project task are done by Bash scripts and Make files within the Ion Shell repository.
As pointed out in a posted issue \cite{issue_convert_make_files_to_xtask},
this approach does not scale well on the long run.
This issues proposed the usage of the cargo-xtask convention instead of Make files and bash scripts.
Cargo-xtask is a convention in which the workspace feature of cargo is utilized \cite{repos_cargo_xtask}.
Via this workflow it is possible to write project tasks in Rust.
The following advantages arise from this convention:
\begin{itemize}
	\item Rust scales better for complex problems compared to Bash.
	\item Only one language in the project for the application and for the automation system.
	\item People do not need to learn another stack beside Rust.
	\item Rust has powerful crates for cli argument parsing. Their Capabilities out match getopts from bash greatly
	\item It is advantageous to get rid of make and bash for a latter windows port.
\end{itemize}

After the discussion on the matrix server with community of Redox OS and under the respective issue
\cite{issue_convert_make_files_to_xtask}, it was agreed to try the conversion.
The conversion to cargo-xtask was started with the following pull request \cite{pr_still_opened_cargo_xtask}.
This pull request is the first of three planned pull requests for the conversion.
That strategy allows to conduct the conversion step by step
However the first pull request is not  merged yet,
even after asking for a review on this pull request several times.



